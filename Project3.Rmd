---
title: "Get to Know Lesser Known Tidyverse Functions"
author: "Sofia Hirschmann"
date: "26 April 2021"
output: learnr::tutorial
runtime: shiny_prerendered
description: How to use the if_else() and case_when() functions...
---

```{r, warning = FALSE, message = FALSE, echo=FALSE}
library(tidyverse)
```

```{r setup, include=FALSE}
library(learnr)
tutorial_options(exercise.eval = TRUE)
```

```{r, echo = FALSE, warning = FALSE, message = FALSE}
# Load any datasets you may need
ExamScores <- data.frame(Student = c("Student1", "Student2", "Student3", "Student4", "Studen5", "Student6", "Student7", "Student8", "Student9", "Student10", "Student11", "Student12", "Student13", "Student14", "Studen15", "Student16", "Student17", "Student18", "Student19", "Student20", "Student21", "Student22", "Student23", "Student24", "Studen25", "Student26", "Student27", "Student28", "Student29", "Student30", "Student31", "Student32", "Student33", "Student34", "Studen35", "Student36", "Student37", "Student38", "Student39", "Student40", "Student41", "Student42", "Student43", "Student44", "Studen45", "Student46", "Student47", "Student48", "Student49", "Student50" ),
                 Score = c(95, 77, 98, 87, 65, 43, 71, 53, 93, 67, 59, 99, 37, 72, 91, 80, 47, 57, 78, 61, 75, 88, 95, 60, 40, 77, 84, 64, 74, 83, 54, 75, 87, 79, 66, 69, 82, 86, 85, 90, 79, 81, 97, 63, 62, 87, 79, 67, 72, 86))
```

# **Condtional Functions**

## Backstory

Imagine you are a new Math professor. You are teaching a class of 50 students and they just took their first exam of the semester. The dataset labeled **ExamScores** that I have created provides the distribution of the scores that your students earned on this first exam. 

There are two questions that you as the professor would like to have answered before your class meets next.
- *How many students passed this exam?*
- *What is the grade distribution of the scores earned?*

## Commands
...In order to answer these questions you are going to use the Exam Scores dataset along with two conditional statement functions, the tidyverse functions **if_else()** and **case_when()**

Refresher of other operations used in this exercise:
* mutate() - adds new variables and preserves existing ones
* transmute() - adds new variables and drops existing ones
* group_by() - organizes a column by the variables present
* summarize(count = n()) - returns the amount of each categorical variable that is present
* we use %>% to connect commands

## **if_else()**
The command *if_else()* performs a singular operation on an entire vector all at once. 

...The command is set up using the formula *if_else(logical condition, what should be returned when logical condition is true, what should be returned when condition is not met)*

Hence the if/else title, after the condition is stated, the command includes what the resulting category would be **if** the condition is met and what everything **else** that does not meet the condition would be categorized as.

In the case of this example we are categorizing values (the individual scores), we categorize the values by classifying them as either **Pass** or **Fail**.
```{r, message=FALSE}
PassFail = ExamScores %>% 
  transmute(Student = Student, #for a new dataset that keeps the Student column
            PassFail = if_else(Score < 60, "Fail", "Pass")) #for new dataset exchange Score column for PassFail column

PassFail

PassFail %>% 
  group_by(PassFail) %>% #organizes students by whether they passed or failed
  summarize(count = n()) #counts how many students were present in each group
```

* *By running this code we find that 8 of the students failed the exam and 42 students passed the exam so we can now go into the class knowing how well the class did as a whole. To take this further, the next function will allow you to break the scores down a bit more so that you can see exactly how well the passing students did, by looking at the grades they will receive.*

## **case_when()**
The command *case_when()* is another tool in data manipulation, it wors much like the *if_else()* function, however, instead of replacing a variable/column it creates a new one, it is also easier to use when applying more than one condition to a dataset. 

...The command is set up by first labeling whatever you would like the new variable to be called and setting it equal to case_when()...inside of the parentheses you include each condition followed by ~ 'whatever you would like returned when the condition is true', the last line of this command will then by TRUE ~ 'whatever you would like returned for any value that does not meet the previous conditions'

```{r, message=FALSE}
Grades = ExamScores %>% #new dataset will return as Grades
  mutate(Grade = case_when( Score>= 90 ~ 'A' #creates new variable labeled Grade, scores equal to or above 90 return as an A
          ,Score >= 80 ~ 'B' #scores equal to or above 80 return as a B
          ,Score >= 70 ~ 'C' #scores equal to or above 70 return as a C
          ,Score >= 60 ~ 'D' #scores equal to or above 60 return as a D
          ,TRUE ~ 'F')) #any other scores return as an F

Grades

Grades %>% 
  group_by(Grade) %>% #organizes students by what grade they received
  summarize(count = n()) #counts how many students were present in each group
```

* *By running this code we can see more clearly how well the class did on the first exam. Of the passing students 8 are in the A range and 12 are in the B range, which is quite decent.*

## Conclusion
The conditional statement commands of **if_else()** and **case_when()** are clearly very useful when you want to quickly adjust a dataset of numerical variables into categorical variables in order to answer questions that require categorical information. These fucntions can be aplied to a variety of scenarios utilizing all kinds of conditions. The syntax often varies slightly depending on the condition but there is a lot of information online that can be used to answer any additional questions.

## Try it yourself

*Exercise*

* Practice using the case_when() command yourself!
```{r, echo = FALSE, warning = FALSE, message = FALSE}
# Load any datasets you may need
Group <- data.frame(Person = c("Person1", "Person2", "Person3", "Person4", "Person5", "Person6", "Person7", "Person8", "Person9", "Person10", "Person11", "Person12", "Person13", "Person14", "Person15", "Person16", "Person17", "Person18", "Person19", "Person20", "Person21", "Person22", "Person23", "Person24", "Person25"),
                 Age = c(21, 11, 28, 6, 19, 17, 10, 26, 20, 7, 23, 9, 22, 12, 15, 30, 8, 16, 29, 18, 14, 25, 27, 24, 13))
```

I have created a random data set of a group and their ages the dataset is called **Group**. 
Copy the command that I used to classify the grades, and adjust it with the labels in this data set to create the categories *child*, *teenager*, and *adult*.







